Cumulative_cases[Country == "United States of America"],
New_deaths[Country == "United States of America"],
Cumulative_deaths[Country == "United States of America"])
colnames(US_data) <- data_name
US_data <- as.data.frame(US_data)
## Empirical part.
## Install ggplot2
library("ggplot2")
## Update Date as.Date
df$Date_reported <- as.Date(df$Date_reported)
## Line Graph Analysis of Daily New Cases:
dailynewcases1 <-ggplot(data = df,
aes(x = Date_reported,
y = New_cases,
group = Country,
color = Country)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
dailynewcases1
dailynewcases2 <-ggplot(data = df,
aes(x = Date_reported,
y = `New_cases/100`,
group = Country,
color = Country)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
dailynewcases2
## Line Graph Analysis of Daily New Deaths:
dailynewdeaths1 <-ggplot(data = df,
aes(x = Date_reported,
y = New_deaths,
group = Country,
color = Country)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
dailynewdeaths1
min(df$New_deaths[Country == "United States of America"])
dailynewdeaths2 <-ggplot(data = df,
aes(x = Date_reported,
y = `New_deaths/100`,
group = Country,
color = Country)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
dailynewdeaths2
## Line Graph Analysis of Cumulative cases:
Cumulativecases1 <-ggplot(data = df,
aes(x = Date_reported,
y = Cumulative_cases,
group = Country,
color = Country,
scientific = FALSE)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
Cumulativecases1
Cumulativecases2 <-ggplot(data = df,
aes(x = Date_reported,
y = `Cumulative_cases/100`,
group = Country,
color = Country,
scientific = FALSE)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
Cumulativecases2
## Line Graph Analysis of Cumulative deaths:
Cumulativedeaths1 <-ggplot(data = df,
aes(x = Date_reported,
y = Cumulative_deaths,
group = Country,
color = Country,
scientific = FALSE)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
Cumulativedeaths1
Cumulativedeaths2 <-ggplot(data = df,
aes(x = Date_reported,
y = `Cumulative_deaths/100`,
group = Country,
color = Country,
scientific = FALSE)) +
geom_line() +
scale_x_date(date_breaks = "months", date_labels = "%b") +
theme_minimal()
Cumulativedeaths2
## Overall graph:
## Normal:
plot_grid(dailynewcases1, dailynewdeaths1, Cumulativecases1, Cumulativedeaths1, labels=c("1", "3", "2", "4"), ncol = 2, nrow = 2)
## Per 1 million people
plot_grid(dailynewcases2, dailynewdeaths2, Cumulativecases2, Cumulativedeaths2, labels=c("1", "3", "2", "4"), ncol = 2, nrow = 2)
## Equation (1):
ndidreg1 <- lm (df$`New_cases/100` ~ df$after*df$mandatory)
ndidreg2 <- lm (df$`Cumulative_cases/100` ~ df$after*df$mandatory)
ndidreg3 <- lm (df$`New_deaths/100` ~ df$after*df$mandatory)
ndidreg4 <- lm (df$`Cumulative_deaths/100` ~ df$after*df$mandatory)
##Test in robust-standard error
coeftest(ndidreg1, vcov = hccm)
coeftest(ndidreg2, vcov = hccm)
coeftest(ndidreg3, vcov = hccm)
coeftest(ndidreg4, vcov = hccm)
##Output result in Latex:
stargazer(ndidreg1, ndidreg2, ndidreg3, ndidreg4, type = "latex", single.row = TRUE, no.space = TRUE, column.sep.width = "0.01pt", font.size = "scriptsize")
##Output result in normal text form:
stargazer(ndidreg1, ndidreg2, ndidreg3, ndidreg4, type = "text")
## Equation (2):
## Set up environment:
df1 <- subset(df, subset=(df$nocontrol != 1))
## Regression estimation:
ndidreg5 <- lm (df1$`New_cases/100` ~ df1$after*df1$mandatory)
ndidreg6 <- lm (df1$`Cumulative_cases/100` ~ df1$after*df1$mandatory)
ndidreg7 <- lm (df1$`New_deaths/100` ~ df1$after*df1$mandatory)
ndidreg8 <- lm (df1$`Cumulative_deaths/100` ~ df1$after*df1$mandatory)
##Test in robust-standard error
coeftest(ndidreg5, vcov = hccm)
coeftest(ndidreg6, vcov = hccm)
coeftest(ndidreg7, vcov = hccm)
coeftest(ndidreg8, vcov = hccm)
##Output result in Latex:
stargazer(ndidreg5, ndidreg6, ndidreg7, ndidreg8, type = "latex", single.row = TRUE, no.space = TRUE, column.sep.width = "0.01pt", font.size = "scriptsize")
##Output result in normal text form:
stargazer(ndidreg5, ndidreg6, ndidreg7, ndidreg8, type = "text")
##Equation (3):
df2 <- subset(df, subset=(df$mandatory != 1))
ndidreg9 <- lm(df2$`New_cases/100` ~ df2$after*df2$optional)
ndidreg10 <- lm(df2$`Cumulative_cases/100`~ df2$after*df2$optional)
ndidreg11 <- lm(df2$`New_deaths/100` ~ df2$after*df2$optional)
ndidreg12 <- lm(df2$`Cumulative_deaths/100` ~ df2$after*df2$optional)
##Output result in Latex:
stargazer(ndidreg9, ndidreg10, ndidreg11, ndidreg12, type = "latex", single.row = TRUE, no.space = TRUE, column.sep.width = "0.01pt", font.size = "scriptsize")
##Output result in normal text form:
stargazer(ndidreg9, ndidreg10, ndidreg11, ndidreg12, type = "text")
##Test in robust-standard error
coeftest(ndidreg9, vcov = hccm)
coeftest(ndidreg10, vcov = hccm)
coeftest(ndidreg11, vcov = hccm)
coeftest(ndidreg12, vcov = hccm)
##Test the reason why cumulative deaths are higher in optional-policy country
df3 <- subset(df, subset=(df$mandatory != 1))
df3 <- subset(df, subset=(df$Country != "India"))
##Test reg 1 exclude the country "India"
testreg1 <- lm(df3$`Cumulative_deaths/100` ~ df3$after*df3$optional)
stargazer(testreg1 ,type = "text")
##test reg2 environment set-up
df4 <- subset(df, subset=(df$mandatory != 1))
df4 <- subset(df, subset=(df$Country_code != "US"))
##Test reg 2 exclude the country "United States of America"
testreg2 <- lm(df4$`Cumulative_deaths/100` ~ df4$after*df4$optional)
stargazer(testreg2 ,type = "text")
## Graph Equation normal DID line trends:
## Set up environment:
df$policygroup <- ifelse(df$mandatory == 1, 1, ifelse(df$optional == 1, 2, ifelse(df$nocontrol == 1, 3, 0)))
##Graph part
attach(df)
equation1graph <- ggplot(df, aes(day,
`New_cases/100`,
color = policygroup,
group = policygroup)) +
geom_vline(xintercept = 0, linetype = 4) +
geom_vline(xintercept = 50, linetype = 4, color = "red") +
geom_smooth() +
theme_minimal()
equation1graph
equation2graph <- ggplot(df, aes(day,
`Cumulative_cases/100`,
color = policygroup,
group = policygroup)) +
geom_vline(xintercept = 0, linetype = 4) +
geom_vline(xintercept = 50, linetype = 4, color = "red") +
geom_smooth() +
theme_minimal()
equation2graph
###Clean out environment###
rm(list = ls())
###Install library###
library(readstata13)
library(Matrix)
library(gamlr)
library(dplyr)
library(vtable)
library(ranger)
library(ggplot2)
library(stargazer)
# Environment cleaning and settings ---------------------------------------
##Read Data##
df <- read.dta13("D:/Study/ECON 124/Empirical Project/0422analysis.dta")
View(df)
###Clean out environment###
rm(list = ls())
###Install library###
library(readstata13)
library(Matrix)
library(gamlr)
library(dplyr)
library(vtable)
library(ranger)
library(ggplot2)
library(stargazer)
# Environment cleaning and settings ---------------------------------------
##Read Data##
df <- read.dta13("D:/Study/ECON 124/Empirical Project/0422analysis.dta")
##Import ROC function for later use##
roc <- function(p,y, ...){
y <- factor(y)
n <- length(p)
p <- as.vector(p)
Q <- p > matrix(rep(seq(0,1,length=100),n),ncol=100,byrow=TRUE)
specificity <- colMeans(!Q[y==levels(y)[1],])
sensitivity <- colMeans(Q[y==levels(y)[2],])
plot(1-specificity, sensitivity, type="l", ...)
abline(a=0,b=1,lty=2,col=8)
}
##Import R^2 calculation function##
logit_dev <- function(sample_Ys, predictions) {
return(-sum(sample_Ys * log(predictions) + (1 - sample_Ys) * log(1 - predictions)))
}
###Data Observing and cleaning###
##Data Cleaning##
head(df)
dim(df)
##Check NAs in each columns##
S <- length(df)
S <- numeric(S)
for (i in 1:length(df)){
NumNAs <- is.na(df[i])
S[i] <- sum(NumNAs == "TRUE")
}
S
##Clean multiple NAs column (If NA >= 1000)##
column_drop <- which(S >= 1000)
colnames(df[column_drop])
df <- df[ , -(column_drop)]
#omit NAs#
df <- na.omit(df)
dim(df)
#Drop useless Friend columns#
which(colnames(df) == "friend1")
which(colnames(df) == "friend5")
df <- df[ , -(32:36)]
##Rearrange row number
df <- arrange(df)
###Data factorization###
##Quick check##
str(df)
#Drop useless data#
rm(NumNAs, i, S, column_drop)
# Data Overview -----------------------------------------------------------
##Understanding regression##
under_reg0 <- glm(df$understanding ~ df$day)
under_reg1 <- glm(df$understanding ~ df$day*as.factor(df$region))
under_reg2 <- glm(df$understanding ~ df$day*as.factor(df$region) + df$risk_averse*as.factor(df$region) + df$insurance_repay*as.factor(df$region) + df$age*as.factor(df$region) +df$educ*as.factor(df$region))
stargazer(under_reg0, under_reg1, under_reg2, type = "latex", single.row = TRUE, no.space = TRUE, column.sep.width = "0.01pt", font.size = "scriptsize")
summary(under_reg0)
stargazer(under_reg0, type = "text")
summary(under_reg1)
summary(under_reg2)
df_table <- df[ , -(29:50)]
df_table <- df_table[ , -1]
table_variables <- c("day", "region", "risk_averse", "insurance_repay", "age", "educ", "understanding")
A <- numeric(length(table_variables))
for (j in 1:length(A)){
A[j] <- which(colnames(df_table) == table_variables[j])
}
df_table <-df_table[A]
st(df_table, summ=c('mean(x)','median(x)','max(x)', 'min(x)'), summ.names = c("Mean", "Median", "Max", "Min"), group = "region", out = "text")
###Clean out environment###
rm(list = ls())
###Install library###
library(readstata13)
library(Matrix)
library(gamlr)
library(dplyr)
library(vtable)
library(ranger)
library(ggplot2)
library(stargazer)
# Environment cleaning and settings ---------------------------------------
##Read Data##
df <- read.dta13("D:/Study/ECON 124/Empirical Project/0422analysis.dta")
##Import ROC function for later use##
roc <- function(p,y, ...){
y <- factor(y)
n <- length(p)
p <- as.vector(p)
Q <- p > matrix(rep(seq(0,1,length=100),n),ncol=100,byrow=TRUE)
specificity <- colMeans(!Q[y==levels(y)[1],])
sensitivity <- colMeans(Q[y==levels(y)[2],])
plot(1-specificity, sensitivity, type="l", ...)
abline(a=0,b=1,lty=2,col=8)
}
##Import R^2 calculation function##
logit_dev <- function(sample_Ys, predictions) {
return(-sum(sample_Ys * log(predictions) + (1 - sample_Ys) * log(1 - predictions)))
}
###Data Observing and cleaning###
##Data Cleaning##
head(df)
dim(df)
##Check NAs in each columns##
S <- length(df)
S <- numeric(S)
for (i in 1:length(df)){
NumNAs <- is.na(df[i])
S[i] <- sum(NumNAs == "TRUE")
}
S
##Clean multiple NAs column (If NA >= 1000)##
column_drop <- which(S >= 1000)
colnames(df[column_drop])
df <- df[ , -(column_drop)]
#omit NAs#
df <- na.omit(df)
dim(df)
#Drop useless Friend columns#
which(colnames(df) == "friend1")
which(colnames(df) == "friend5")
df <- df[ , -(32:36)]
##Rearrange row number
df <- arrange(df)
###Data factorization###
##Quick check##
str(df)
#Drop useless data#
rm(NumNAs, i, S, column_drop)
# Data Overview -----------------------------------------------------------
##Understanding regression##
under_reg0 <- glm(df$understanding ~ df$day)
under_reg1 <- glm(df$understanding ~ df$day*as.factor(df$region))
under_reg2 <- glm(df$understanding ~ df$day*as.factor(df$region) + df$risk_averse*as.factor(df$region) + df$insurance_repay*as.factor(df$region) + df$age*as.factor(df$region) +df$educ*as.factor(df$region))
stargazer(under_reg0, under_reg1, under_reg2, type = "latex", single.row = TRUE, no.space = TRUE, column.sep.width = "0.01pt", font.size = "scriptsize")
summary(under_reg0)
stargazer(under_reg0, type = "text")
summary(under_reg1)
summary(under_reg2)
df_table <- df[ , -(29:50)]
df_table <- df_table[ , -1]
table_variables <- c("day", "region", "risk_averse", "insurance_repay", "age", "educ", "understanding")
A <- numeric(length(table_variables))
for (j in 1:length(A)){
A[j] <- which(colnames(df_table) == table_variables[j])
}
df_table <-df_table[A]
st(df_table, summ=c('mean(x)','median(x)','max(x)', 'min(x)'), summ.names = c("Mean", "Median", "Max", "Min"), group = "region", out = "text")
# Logit Model OLS analysis ------------------------------------------------
#Factorize#
df <- df[,-1]
non_factor_columns <- c("takeup_survey", "age", "agpop", "educ", "rice_inc", "ricearea_2010", "disaster_prob", "understanding", "day", "risk_averse")
factor_columns <- 1:ncol(df)
S <- length(non_factor_columns)
S <- numeric(S)
for (j in 1:length(S)){
S[j] <- which(colnames(df) == non_factor_columns[j])
}
S <- c(S, (28:30))
S <- c(S, (35:49))
S
factor_columns <- factor_columns[-S]
factor_columns
##Factorize variables and introduce NAs
for (i in factor_columns){
df[, i] <- factor(df[, i])
}
#Create another df for Random Forest before naref()#
df <- df[ , -(38:49)]
df_rf <- df
##Logit Model Analysis##
set.seed(0)
logit_reg_1 <- glm(takeup_survey ~ .- insurance_buy, data = df, family = "binomial")
significant_varaibles <- summary(logit_reg_1)$coefficients
vars <- rownames(significant_varaibles)[which(significant_varaibles[, 4] < 0.05)]
logit_reg_1$coefficients[significant_varaibles]
vars
stargazer(logit_reg_1, type = "text", keep = vars, omit = vars)
df <- naref(df)
#Testify#
levels(df$age)
levels(df$literacy)
levels(df$insurance_buy)
#QUick Check Variables again#
str(df)
##Cross-validation##
##IS CV##
set.seed(0)
x_matrix_cv_1 <- model.matrix(df$takeup_survey ~ . - address - village - insurance_buy, data = df)[ , -1]
cv.logit1 <- cv.gamlr(x_matrix_cv_1, df$takeup_survey, nfold = 30, family = "binomial")
par(mfrow=c(1,2))
plot(cv.logit1$gamlr, main = "Lasso Regularization path")
par(mfrow=c(1,2))
plot(cv.logit1$gamlr, main = "Lasso Regularization path")
logit_reg_1$coefficients[significant_varaibles]
vars
stargazer(logit_reg_1, type = "text", keep = vars, omit = vars)
df <- naref(df)
#Testify#
levels(df$age)
levels(df$literacy)
levels(df$insurance_buy)
#QUick Check Variables again#
str(df)
##Cross-validation##
##IS CV##
set.seed(0)
x_matrix_cv_1 <- model.matrix(df$takeup_survey ~ . - address - village - insurance_buy, data = df)[ , -1]
cv.logit1 <- cv.gamlr(x_matrix_cv_1, df$takeup_survey, nfold = 30, family = "binomial")
par(mfrow=c(1,2))
plot(cv.logit1$gamlr, main = "Lasso Regularization path")
actual_insurance_buy <- df$takeup_survey
#Histogram of the prediction_cv_1#
hist(predict_IS_cv, breaks = 50, xlab = "Preicted Probabilities", ylab = "Numbers of probabilities", main = "Distribution of the prediction probabilities", axes = FALSE)
axis(2)
axis(1, at = seq(0, 1, by = 0.02), labels = seq(0, 1, by = 0.02))
#IS ROC#
roc(predict_IS_cv, actual_insurance_buy, bty = "n", main = "IS ROC")
cut_offs <- c(0.02, 0.1, 0.5, 0.8, 0.9)
points_colors <- c("blue", "yellow", "red", "green", "pink")
for(j in 1:length(cut_offs)){
points(x = 1 - mean((predict_IS_cv <= cut_offs[j])[df$takeup_survey == 0]), y = mean((predict_IS_cv >cut_offs[j])[df$takeup_survey == 1]), cex = 3, pch = 20, col = points_colors[j])
}
legend("bottomright", fill = points_colors, legend = cut_offs, bty = "n", title = "cutoffs")
#Comparison#
IS_prediction <- ifelse(predict_IS_cv > 0.5, 1, 0)
prediction_correct_rate_IS <- ifelse(df$insurance_buy == IS_prediction, 1, 0)
length(prediction_correct_rate_IS[prediction_correct_rate_IS == 1])/length(prediction_correct_rate_IS) * 100
actual_correct_rate_IS <- ifelse(df$takeup_survey == IS_prediction, 1, 0)
###Clean out environment###
rm(list = ls())
###Install library###
library(readstata13)
library(Matrix)
library(gamlr)
library(dplyr)
library(vtable)
library(ranger)
library(ggplot2)
library(stargazer)
# Environment cleaning and settings ---------------------------------------
##Read Data##
df <- read.dta13("D:/Study/ECON 124/Empirical Project/0422analysis.dta")
##Import ROC function for later use##
roc <- function(p,y, ...){
y <- factor(y)
n <- length(p)
p <- as.vector(p)
Q <- p > matrix(rep(seq(0,1,length=100),n),ncol=100,byrow=TRUE)
specificity <- colMeans(!Q[y==levels(y)[1],])
sensitivity <- colMeans(Q[y==levels(y)[2],])
plot(1-specificity, sensitivity, type="l", ...)
abline(a=0,b=1,lty=2,col=8)
}
##Import R^2 calculation function##
logit_dev <- function(sample_Ys, predictions) {
return(-sum(sample_Ys * log(predictions) + (1 - sample_Ys) * log(1 - predictions)))
}
###Data Observing and cleaning###
##Data Cleaning##
head(df)
dim(df)
##Check NAs in each columns##
S <- length(df)
S <- numeric(S)
for (i in 1:length(df)){
NumNAs <- is.na(df[i])
S[i] <- sum(NumNAs == "TRUE")
}
S
##Clean multiple NAs column (If NA >= 1000)##
column_drop <- which(S >= 1000)
colnames(df[column_drop])
df <- df[ , -(column_drop)]
#omit NAs#
df <- na.omit(df)
dim(df)
#Drop useless Friend columns#
which(colnames(df) == "friend1")
which(colnames(df) == "friend5")
df <- df[ , -(32:36)]
##Rearrange row number
df <- arrange(df)
###Data factorization###
##Quick check##
str(df)
#Drop useless data#
rm(NumNAs, i, S, column_drop)
# Data Overview -----------------------------------------------------------
##Understanding regression##
under_reg0 <- glm(df$understanding ~ df$day)
under_reg1 <- glm(df$understanding ~ df$day*as.factor(df$region))
under_reg2 <- glm(df$understanding ~ df$day*as.factor(df$region) + df$risk_averse*as.factor(df$region) + df$insurance_repay*as.factor(df$region) + df$age*as.factor(df$region) +df$educ*as.factor(df$region))
stargazer(under_reg0, under_reg1, under_reg2, type = "latex", single.row = TRUE, no.space = TRUE, column.sep.width = "0.01pt", font.size = "scriptsize")
summary(under_reg0)
stargazer(under_reg0, type = "text")
summary(under_reg1)
summary(under_reg2)
df_table <- df[ , -(29:50)]
df_table <- df_table[ , -1]
table_variables <- c("day", "region", "risk_averse", "insurance_repay", "age", "educ", "understanding")
A <- numeric(length(table_variables))
for (j in 1:length(A)){
A[j] <- which(colnames(df_table) == table_variables[j])
}
df_table <-df_table[A]
st(df_table, summ=c('mean(x)','median(x)','max(x)', 'min(x)'), summ.names = c("Mean", "Median", "Max", "Min"), group = "region", out = "text")
# Logit Model OLS analysis ------------------------------------------------
#Factorize#
df <- df[,-1]
non_factor_columns <- c("takeup_survey", "age", "agpop", "educ", "rice_inc", "ricearea_2010", "disaster_prob", "understanding", "day", "risk_averse")
st(df_table, summ =c('mean(x)','median(x)','max(x)', 'min(x)'), summ.names = c("Mean", "Median", "Max", "Min"), group = "region")
